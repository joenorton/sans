{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "sans report.json",
  "type": "object",
  "required": [
    "report_schema_version",
    "status",
    "exit_code_bucket",
    "primary_error",
    "diagnostics",
    "inputs",
    "artifacts",
    "outputs",
    "plan_path",
    "engine",
    "settings",
    "timing"
  ],
  "properties": {
    "report_schema_version": {
      "type": "string",
      "minLength": 1,
      "description": "Current version: 0.3. JSON artifacts are hashed using canonical JSON serialization."
    },
    "status": {"enum": ["ok", "ok_warnings", "refused", "failed"]},
    "exit_code_bucket": {"enum": [0, 10, 20, 30, 31, 32, 50]},
    "primary_error": {
      "anyOf": [
        {"type": "null"},
        {"$ref": "#/definitions/error"}
      ]
    },
    "diagnostics": {
      "type": "array",
      "items": {"$ref": "#/definitions/error"}
    },
    "inputs": {
      "type": "array",
      "items": {"$ref": "#/definitions/input"}
    },
    "artifacts": {
      "type": "array",
      "items": {"$ref": "#/definitions/artifact"}
    },
    "outputs": {
      "type": "array",
      "items": {"$ref": "#/definitions/output"}
    },
    "plan_path": {"type": "string"},
    "report_sha256": {"type": "string"},
    "engine": {
      "type": "object",
      "required": ["name", "version"],
      "properties": {
        "name": {"type": "string"},
        "version": {"type": "string"}
      }
    },
    "settings": {"type": "object"},
    "timing": {
      "type": "object",
      "required": ["compile_ms", "validate_ms", "execute_ms"],
      "properties": {
        "compile_ms": {"type": ["integer", "null"]},
        "validate_ms": {"type": ["integer", "null"]},
        "execute_ms": {"type": ["integer", "null"]}
      }
    },
    "runtime": {
      "type": "object",
      "required": ["status", "timing"],
      "properties": {
        "status": {"enum": ["ok", "refused", "failed"]},
        "timing": {
          "type": "object",
          "required": ["execute_ms"],
          "properties": {
            "execute_ms": {"type": ["integer", "null"]}
          }
        }
      }
    }
  },
  "definitions": {
    "loc": {
      "anyOf": [
        {"type": "null"},
        {
          "type": "object",
          "required": ["file", "line_start", "line_end"],
          "properties": {
            "file": {"type": "string"},
            "line_start": {"type": "integer"},
            "line_end": {"type": "integer"}
          }
        }
      ]
    },
    "error": {
      "type": "object",
      "required": ["code", "message", "loc"],
      "properties": {
        "code": {"type": "string"},
        "message": {"type": "string"},
        "loc": {"$ref": "#/definitions/loc"}
      }
    },
    "input": {
      "type": "object",
      "required": ["role", "name", "path", "sha256"],
      "properties": {
        "role": {"type": "string", "enum": ["source", "preprocessed", "expanded", "datasource"]},
        "name": {"type": "string", "minLength": 1},
        "path": {"type": "string", "minLength": 1},
        "sha256": {"type": "string", "minLength": 1}
      }
    },
    "artifact": {
      "type": "object",
      "required": ["name", "path", "sha256"],
      "properties": {
        "name": {"type": "string", "minLength": 1},
        "path": {"type": "string", "minLength": 1},
        "sha256": {"type": "string", "minLength": 1}
      }
    },
    "output": {
      "type": "object",
      "required": ["name", "path", "sha256"],
      "properties": {
        "name": {"type": "string", "minLength": 1},
        "path": {"type": "string", "minLength": 1},
        "sha256": {"type": "string", "minLength": 1},
        "rows": {"type": ["integer", "null"]},
        "columns": {
          "type": ["array", "null"],
          "items": {"type": "string"}
        }
      }
    }
  }
}
